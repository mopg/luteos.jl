# ---------------------------------------------------------------------------- #
#
#   basisFuncTriangleLag.jl
#
#   Get Lagrangian basis functions for Triangle
#
#   λυτέος
#   Fall 2017
#
#   Max Opgenoord
#
# ---------------------------------------------------------------------------- #

function basisFuncTriangleLag( ::Type{Val{1}}, s::Array{Float64}, t::Array{Float64} )

  dim = 2
  nx  = length( s )

  # Linear

  nphi = 3
  phi  = Array{Float64}(nx, nphi)
  dphi = Array{Float64}(nx, nphi, dim)

  # value
  phi[:,1] = -s -t + 1.0
  phi[:,2] =  s
  phi[:,3] =  t

  # derivative in x
  dphi[:,1,1] =  -1.0
  dphi[:,2,1] =   1.0
  dphi[:,3,1] =   0.0

  # derivative in y
  dphi[:,1,2] =  -1.0
  dphi[:,2,2] =   0.0
  dphi[:,3,2] =   1.0

  # transpose
  phi   = phi'

  dphi2 = fill( 0.0, size(dphi,2), size(dphi,1), 2 )
  dphi2[:,:,1] = dphi[:,:,1]'
  dphi2[:,:,2] = dphi[:,:,2]'

  return phi, dphi2

end

function basisFuncTriangleLag( ::Type{Val{2}}, s::Array{Float64}, t::Array{Float64} )

  dim = 2
  nx  = length( s )

  # Quadratric

  nphi = 6
  phi  = Array{Float64}(nx, nphi)
  dphi = Array{Float64}(nx, nphi, dim)

  # value
  phi[:,1] = s.*-3.0-t.*3.0+s.*t.*4.0+(s.*s).*2.0+(t.*t).*2.0+1.0
  phi[:,2] = -s+(s.*s).*2.0
  phi[:,3] = -t+(t.*t).*2.0
  phi[:,4] = s.*t.*4.0
  phi[:,5] = t.*(s+t-1.0).*-4.0
  phi[:,6] = -s.*(s.*4.0+t.*4.0-4.0)

  # derivative in x
  dphi[:,1,1] = s.*4.0+t.*4.0-3.0
  dphi[:,2,1] = s.*4.0-1.0
  dphi[:,3,1] = 0.0
  dphi[:,4,1] = t.*4.0
  dphi[:,5,1] = t.*-4.0
  dphi[:,6,1] = s.*-8.0-t.*4.0+4.0

  # derivative in y
  dphi[:,1,2] = s.*4.0+t.*4.0-3.0
  dphi[:,2,2] = 0.0
  dphi[:,3,2] = t.*4.0-1.0
  dphi[:,4,2] = s.*4.0
  dphi[:,5,2] = s.*-4.0-t.*8.0+4.0
  dphi[:,6,2] = s.*-4.0

  # transpose
  phi   = phi'

  dphi2 = fill( 0.0, size(dphi,2), size(dphi,1), 2 )
  dphi2[:,:,1] = dphi[:,:,1]'
  dphi2[:,:,2] = dphi[:,:,2]'

  return phi, dphi2

end

function basisFuncTriangleLag( ::Type{Val{3}}, s::Array{Float64}, t::Array{Float64} )

  dim = 2
  nx  = length( s )

  nphi = 10
  phi  = Array{Float64}(nx, nphi)
  dphi = Array{Float64}(nx, nphi, dim)

  # value
  phi[:, 1] = s.*(-1.1E1/2.0)-t.*(1.1E1/2.0)+s.*t.*1.8E1-s.*(t.*t).*(2.7E1/2.0)-(s.*s).*t.*(2.7E1/2.0)+(s.*s).*9.0-
              (s.*s.*s).*(9.0/2.0)+(t.*t).*9.0-(t.*t.*t).*(9.0/2.0)+1.0
  phi[:, 2] = s-(s.*s).*(9.0/2.0)+(s.*s.*s).*(9.0/2.0)
  phi[:, 3] = t-(t.*t).*(9.0/2.0)+(t.*t.*t).*(9.0/2.0)
  phi[:, 4] = s.*t.*(-9.0/2.0)+(s.*s).*t.*(2.7E1/2.0)

  phi[:,5] =  s.*t.*(-9.0/2.0)+s.*(t.*t).*(2.7E1/2.0)

  phi[:,6] =  t.*(-9.0/2.0)+s.*t.*(9.0/2.0)-s.*(t.*t).*(2.7E1/2.0)+(t.*t).*1.8E1-(t.*t.*t).*(2.7E1/2.0)

  phi[:,7] =  t.*9.0-s.*t.*(4.5E1/2.0)+s.*(t.*t).*2.7E1+(s.*s).*t.*(2.7E1/2.0)-(t.*t).*(4.5E1/2.0)+(t.*t.*t).*(2.7E1/2.0)

  phi[:,8] =  s.*9.0-s.*t.*(4.5E1/2.0)+s.*(t.*t).*(2.7E1/2.0)+(s.*s).*t.*2.7E1-(s.*s).*(4.5E1/2.0)+(s.*s.*s).*(2.7E1/2.0)

  phi[:,9] =  s.*(-9.0/2.0)+s.*t.*(9.0/2.0)-(s.*s).*t.*(2.7E1/2.0)+(s.*s).*1.8E1-(s.*s.*s).*(2.7E1/2.0)

  phi[:,10] =  s.*t.*2.7E1-s.*(t.*t).*2.7E1-(s.*s).*t.*2.7E1

  # derivative in x
  dphi[:,1,1] =  s.*1.8E1+t.*1.8E1-s.*t.*2.7E1-(s.*s).*(2.7E1/2.0)-(t.*t).*(2.7E1/2.0)-1.1E1/2.0

  dphi[:,2,1] =  s.*-9.0+(s.*s).*(2.7E1/2.0)+1.0

  dphi[:,3,1] =  0.0

  dphi[:,4,1] =  t.*(-9.0/2.0)+s.*t.*2.7E1

  dphi[:,5,1] =  t.*(-9.0/2.0)+(t.*t).*(2.7E1/2.0)

  dphi[:,6,1] =  t.*(9.0/2.0)-(t.*t).*(2.7E1/2.0)

  dphi[:,7,1] =  t.*(-4.5E1/2.0)+s.*t.*2.7E1+(t.*t).*2.7E1

  dphi[:,8,1] =  s.*-4.5E1-t.*(4.5E1/2.0)+s.*t.*5.4E1+(s.*s).*(8.1E1/2.0)+(t.*t).*(2.7E1/2.0)+9.0

  dphi[:,9,1] =  s.*3.6E1+t.*(9.0/2.0)-s.*t.*2.7E1-(s.*s).*(8.1E1/2.0)-9.0/2.0

  dphi[:,10,1] =  t.*2.7E1-s.*t.*5.4E1-(t.*t).*2.7E1

  # dphi/dy
  dphi[:,1,2] =  s.*1.8E1+t.*1.8E1-s.*t.*2.7E1-(s.*s).*(2.7E1/2.0)-(t.*t).*(2.7E1/2.0)-1.1E1/2.0
  dphi[:,2,2] =  0.0
  dphi[:,3,2] =  t.*-9.0+(t.*t).*(2.7E1/2.0)+1.0
  dphi[:,4,2] =  s.*(-9.0/2.0)+(s.*s).*(2.7E1/2.0)
  dphi[:,5,2] =  s.*(-9.0/2.0)+s.*t.*2.7E1
  dphi[:,6,2] =  s.*(9.0/2.0)+t.*3.6E1-s.*t.*2.7E1-(t.*t).*(8.1E1/2.0)-9.0/2.0
  dphi[:,7,2] =  s.*(-4.5E1/2.0)-t.*4.5E1+s.*t.*5.4E1+(s.*s).*(2.7E1/2.0)+(t.*t).*(8.1E1/2.0)+9.0
  dphi[:,8,2] =  s.*(-4.5E1/2.0)+s.*t.*2.7E1+(s.*s).*2.7E1
  dphi[:,9,2] =  s.*(9.0/2.0)-(s.*s).*(2.7E1/2.0)
  dphi[:,10,2] =  s.*2.7E1-s.*t.*5.4E1-(s.*s).*2.7E1

  # transpose
  phi   = phi'

  dphi2 = fill( 0.0, size(dphi,2), size(dphi,1), 2 )
  dphi2[:,:,1] = dphi[:,:,1]'
  dphi2[:,:,2] = dphi[:,:,2]'

  return phi, dphi2

end

function basisFuncTriangleLag( ::Type{Val{4}}, s::Array{Float64}, t::Array{Float64} )

  dim = 2
  nx  = length( s )

  nphi = 15
  phi  = Array{Float64}(nx, nphi)
  dphi = Array{Float64}(nx, nphi, dim)

  # value
  phi[:,1] =  (s.*s).*(t.*t).*6.4E1-(1./3).*s.*2.5E1-(1./3).*t.*2.5E1+(1./3).*(s.*s).*7.0E1-(1./3).*(s.*s.*s).*8.0E1+
      (1./3).*(s.*s.*s.*s).*3.2E1+(1./3).*(t.*t).*7.0E1-(1./3).*(t.*t.*t).*8.0E1+(1./3).*(t.*t.*t.*t).*3.2E1-s.*(t.*t).*
      8.0E1-(s.*s).*t.*8.0E1+(1./3).*s.*t.*1.4E2+(1./3).*s.*(t.*t.*t).*1.28E2+(1./3).*(s.*s.*s).*t.*1.28E2+1.0

  phi[:,2] =  -s+(1./3).*(s.*s).*2.2E1+(1./3).*(s.*s.*s.*s).*3.2E1-(s.*s.*s).*1.6E1

  phi[:,3] =  -t+(1./3).*(t.*t).*2.2E1+(1./3).*(t.*t.*t.*t).*3.2E1-(t.*t.*t).*1.6E1

  phi[:,4] =  (s.*s).*t.*-3.2E1+(1./3).*s.*t.*1.6E1+(1./3).*(s.*s.*s).*t.*1.28E2

  phi[:,5] =  (s.*s).*(t.*t).*6.4E1+s.*t.*4.0-s.*(t.*t).*1.6E1-(s.*s).*t.*1.6E1

  phi[:,6] =  s.*(t.*t).*-3.2E1+(1./3).*s.*t.*1.6E1+(1./3).*s.*(t.*t.*t).*1.28E2

  phi[:,7] =  (1./3).*t.*1.6E1-(1./3).*(t.*t).*1.12E2+(1./3).*(t.*t.*t).*2.24E2-(1./3).*(t.*t.*t.*t).*1.28E2+s.*
      (t.*t).*3.2E1-(1./3).*s.*t.*1.6E1-(1./3).*s.*(t.*t.*t).*1.28E2

  phi[:,8] =  t.*-1.2E1+(s.*s).*(t.*t).*6.4E1+s.*t.*2.8E1-s.*(t.*t).*1.44E2-(s.*s).*t.*1.6E1+s.*(t.*t.*t).*1.28E2+(t.*t).*7.6E1-
      (t.*t.*t).*1.28E2+(t.*t.*t.*t).*6.4E1

  phi[:,9] =  t.*1.6E1-(s.*s).*(t.*t).*1.28E2-(1./3).*(t.*t).*2.08E2-(1./3).*(t.*t.*t.*t).*1.28E2+s.*(t.*t).*1.92E2+(s.*
      s).*t.*9.6E1-s.*(t.*t.*t).*1.28E2+(t.*t.*t).*9.6E1-(1./3).*s.*t.*2.08E2-(1./3).*(s.*s.*s).*t.*1.28E2

  phi[:,10] =  s.*1.6E1-(s.*s).*(t.*t).*1.28E2-(1./3).*(s.*s).*2.08E2-(1./3).*(s.*s.*s.*s).*1.28E2+s.*(t.*t).*9.6E1+(s.*
      s).*t.*1.92E2-(s.*s.*s).*t.*1.28E2+(s.*s.*s).*9.6E1-(1./3).*s.*t.*2.08E2-(1./3).*s.*(t.*t.*t).*1.28E2

  phi[:,11] =  s.*-1.2E1+(s.*s).*(t.*t).*6.4E1+s.*t.*2.8E1-s.*(t.*t).*1.6E1-(s.*s).*t.*1.44E2+(s.*s.*s).*t.*1.28E2+(s.*s).*7.6E1-
      (s.*s.*s).*1.28E2+(s.*s.*s.*s).*6.4E1

  phi[:,12] =  (1./3).*s.*1.6E1-(1./3).*(s.*s).*1.12E2+(1./3).*(s.*s.*s).*2.24E2-(1./3).*(s.*s.*s.*s).*1.28E2+(s.*
      s).*t.*3.2E1-(1./3).*s.*t.*1.6E1-(1./3).*(s.*s.*s).*t.*1.28E2

  phi[:,13] =  (s.*s).*(t.*t).*2.56E2+s.*t.*9.6E1-s.*(t.*t).*2.24E2-(s.*s).*t.*2.24E2+s.*(t.*t.*t).*1.28E2+(s.*s.*s).*t.*1.28E2

  phi[:,14] =  (s.*s).*(t.*t).*-1.28E2-s.*t.*3.2E1+s.*(t.*t).*3.2E1+(s.*s).*t.*1.6E2-(s.*s.*s).*t.*1.28E2

  phi[:,15] =  (s.*s).*(t.*t).*-1.28E2-s.*t.*3.2E1+s.*(t.*t).*1.6E2+(s.*s).*t.*3.2E1-s.*(t.*t.*t).*1.28E2

  # derivative in x
  dphi[:,1,1] =  (1./3).*-2.5E1+(1./3).*s.*1.4E2+(1./3).*t.*1.4E2-s.*t.*1.6E2-(1./3).*(s.*s).*2.4E2+(1./3).*
      (s.*s.*s).*1.28E2+(1./3).*(t.*t.*t).*1.28E2+s.*(t.*t).*1.28E2-(t.*t).*8.0E1+(1./3).*(s.*s).*t.*3.84E2

  dphi[:,2,1] =  (1./3).*s.*4.4E1+(1./3).*(s.*s.*s).*1.28E2-(s.*s).*4.8E1-1.0

  dphi[:,3,1] =  0.0

  dphi[:,4,1] =  (1./3).*t.*1.6E1-s.*t.*6.4E1+(1./3).*(s.*s).*t.*3.84E2

  dphi[:,5,1] =  t.*4.0-s.*t.*3.2E1+s.*(t.*t).*1.28E2-(t.*t).*1.6E1

  dphi[:,6,1] =  (1./3).*t.*1.6E1+(1./3).*(t.*t.*t).*1.28E2-(t.*t).*3.2E1

  dphi[:,7,1] =  (1./3).*t.*-1.6E1-(1./3).*(t.*t.*t).*1.28E2+(t.*t).*3.2E1

  dphi[:,8,1] =  t.*2.8E1-s.*t.*3.2E1+s.*(t.*t).*1.28E2-(t.*t).*1.44E2+(t.*t.*t).*1.28E2

  dphi[:,9,1] =  (1./3).*t.*-2.08E2+s.*t.*1.92E2-s.*(t.*t).*2.56E2+(t.*t).*1.92E2-(t.*t.*t).*1.28E2-(1./3).*(s.*s).*t.*
      3.84E2

  dphi[:,10,1] =  (1./3).*s.*-4.16E2-(1./3).*t.*2.08E2+s.*t.*3.84E2-(1./3).*(s.*s.*s).*5.12E2-(1./3).*(t.*t.*t).*1.28E2-
      s.*(t.*t).*2.56E2-(s.*s).*t.*3.84E2+(s.*s).*2.88E2+(t.*t).*9.6E1+1.6E1

  dphi[:,11,1] =  s.*1.52E2+t.*2.8E1-s.*t.*2.88E2+s.*(t.*t).*1.28E2+(s.*s).*t.*3.84E2-(s.*s).*3.84E2+(s.*s.*s).*2.56E2-(t.*
      t).*1.6E1-1.2E1

  dphi[:,12,1] =  (1./3).*1.6E1-(1./3).*s.*2.24E2-(1./3).*t.*1.6E1+s.*t.*6.4E1+(1./3).*(s.*s).*6.72E2-(1./3).*
      (s.*s.*s).*5.12E2-(1./3).*(s.*s).*t.*3.84E2

  dphi[:,13,1] =  t.*9.6E1-s.*t.*4.48E2+s.*(t.*t).*5.12E2+(s.*s).*t.*3.84E2-(t.*t).*2.24E2+(t.*t.*t).*1.28E2

  dphi[:,14,1] =  t.*-3.2E1+s.*t.*3.2E2-s.*(t.*t).*2.56E2-(s.*s).*t.*3.84E2+(t.*t).*3.2E1

  dphi[:,15,1] =  t.*-3.2E1+s.*t.*6.4E1-s.*(t.*t).*2.56E2+(t.*t).*1.6E2-(t.*t.*t).*1.28E2

  # derivative in y
  dphi[:,1,2] =  (1./3).*-2.5E1+(1./3).*s.*1.4E2+(1./3).*t.*1.4E2-s.*t.*1.6E2+(1./3).*(s.*s.*s).*1.28E2-(1./3).*
      (t.*t).*2.4E2+(1./3).*(t.*t.*t).*1.28E2+(s.*s).*t.*1.28E2-(s.*s).*8.0E1+(1./3).*s.*(t.*t).*3.84E2

  dphi[:,2,2] =  0.0

  dphi[:,3,2] =  (1./3).*t.*4.4E1+(1./3).*(t.*t.*t).*1.28E2-(t.*t).*4.8E1-1.0

  dphi[:,4,2] =  (1./3).*s.*1.6E1+(1./3).*(s.*s.*s).*1.28E2-(s.*s).*3.2E1

  dphi[:,5,2] =  s.*4.0-s.*t.*3.2E1+(s.*s).*t.*1.28E2-(s.*s).*1.6E1

  dphi[:,6,2] =  (1./3).*s.*1.6E1-s.*t.*6.4E1+(1./3).*s.*(t.*t).*3.84E2

  dphi[:,7,2] =  (1./3).*1.6E1-(1./3).*s.*1.6E1-(1./3).*t.*2.24E2+s.*t.*6.4E1+(1./3).*(t.*t).*6.72E2-(1./3).*
      (t.*t.*t).*5.12E2-(1./3).*s.*(t.*t).*3.84E2

  dphi[:,8,2] =  s.*2.8E1+t.*1.52E2-s.*t.*2.88E2+s.*(t.*t).*3.84E2+(s.*s).*t.*1.28E2-(s.*s).*1.6E1-(t.*t).*3.84E2+(t.*t.*t).*
      2.56E2-1.2E1

  dphi[:,9,2] =  (1./3).*s.*-2.08E2-(1./3).*t.*4.16E2+s.*t.*3.84E2-(1./3).*(s.*s.*s).*1.28E2-(1./3).*(t.*t.*t).*5.12E2-
      s.*(t.*t).*3.84E2-(s.*s).*t.*2.56E2+(s.*s).*9.6E1+(t.*t).*2.88E2+1.6E1

  dphi[:,10,2] =  (1./3).*s.*-2.08E2+s.*t.*1.92E2-(s.*s).*t.*2.56E2+(s.*s).*1.92E2-(s.*s.*s).*1.28E2-(1./3).*s.*(t.*t).*
      3.84E2

  dphi[:,11,2] =  s.*2.8E1-s.*t.*3.2E1+(s.*s).*t.*1.28E2-(s.*s).*1.44E2+(s.*s.*s).*1.28E2

  dphi[:,12,2] =  (1./3).*s.*-1.6E1-(1./3).*(s.*s.*s).*1.28E2+(s.*s).*3.2E1

  dphi[:,13,2] =  s.*9.6E1-s.*t.*4.48E2+s.*(t.*t).*3.84E2+(s.*s).*t.*5.12E2-(s.*s).*2.24E2+(s.*s.*s).*1.28E2

  dphi[:,14,2] =  s.*-3.2E1+s.*t.*6.4E1-(s.*s).*t.*2.56E2+(s.*s).*1.6E2-(s.*s.*s).*1.28E2

  dphi[:,15,2] =  s.*-3.2E1+s.*t.*3.2E2-s.*(t.*t).*3.84E2-(s.*s).*t.*2.56E2+(s.*s).*3.2E1

  # transpose
  phi   = phi'

  dphi2 = fill( 0.0, size(dphi,2), size(dphi,1), 2 )
  dphi2[:,:,1] = dphi[:,:,1]'
  dphi2[:,:,2] = dphi[:,:,2]'

  return phi, dphi2

end

function basisFuncTriangleLag( ::Type{Val{5}}, s::Array{Float64}, t::Array{Float64} )

  dim = 2
  nx  = length( s )

  nphi = 21
  phi  = Array{Float64}(nx, nphi)
  dphi = Array{Float64}(nx, nphi, dim)

  # value
  phi[:,1] =  s.*(-1.37E2/1.2E1)-t.*(1.37E2/1.2E1)+(s.*s).*(t.*t).*4.6875E2-(s.*s).*(t.*t.*t).*2.604166666666667E2-(s.*
    s.*s).*(t.*t).*2.604166666666667E2+s.*t.*(3.75E2/4.0)-s.*(t.*t).*2.65625E2-(s.*s).*t.*2.65625E2+s.*(t.*t.*t).*(6.25E2/
    2.0)+(s.*s.*s).*t.*(6.25E2/2.0)-s.*(t.*t.*t.*t).*1.302083333333333E2-(s.*s.*s.*s).*t.*1.302083333333333E2+(s.*s).*(3.75E2/
    8.0)-(s.*s.*s).*8.854166666666667E1+(s.*s.*s.*s).*(6.25E2/8.0)-(s.*s.*s.*s.*s).*(6.25E2/2.4E1)+(t.*t).*(3.75E2/8.0)-
    (t.*t.*t).*8.854166666666667E1+(t.*t.*t.*t).*(6.25E2/8.0)-(t.*t.*t.*t.*t).*(6.25E2/2.4E1)+1.0

  phi[:,2] =  s-(s.*s).*(1.25E2/1.2E1)+(s.*s.*s).*(8.75E2/2.4E1)-(s.*s.*s.*s).*(6.25E2/1.2E1)+(s.*s.*s.*s.*s).*(6.25E2/
    2.4E1)

  phi[:,3] =  t-(t.*t).*(1.25E2/1.2E1)+(t.*t.*t).*(8.75E2/2.4E1)-(t.*t.*t.*t).*(6.25E2/1.2E1)+(t.*t.*t.*t.*t).*(6.25E2/
    2.4E1)

  phi[:,4] =  s.*t.*(-2.5E1/4.0)+(s.*s).*t.*5.729166666666667E1-(s.*s.*s).*t.*(6.25E2/4.0)+(s.*s.*s.*s).*t.*1.302083333333333E2

  phi[:,5] =  (s.*s).*(t.*t).*(-6.25E2/4.0)+(s.*s.*s).*(t.*t).*2.604166666666667E2+(s.*s).*t.*(1.25E2/4.0)-(s.*s.*s).*t.*
    (6.25E2/1.2E1)-(1./6).*s.*t.*2.5E1+(1./6).*s.*(t.*t).*1.25E2

  phi[:,6] =  (s.*s).*(t.*t).*(-6.25E2/4.0)+(s.*s).*(t.*t.*t).*2.604166666666667E2+s.*(t.*t).*(1.25E2/4.0)-s.*(t.*t.*t).*
    (6.25E2/1.2E1)-(1./6).*s.*t.*2.5E1+(1./6).*(s.*s).*t.*1.25E2

  phi[:,7] =  s.*t.*(-2.5E1/4.0)+s.*(t.*t).*5.729166666666667E1-s.*(t.*t.*t).*(6.25E2/4.0)+s.*(t.*t.*t.*t).*1.302083333333333E2

  phi[:,8] =  t.*(-2.5E1/4.0)+s.*t.*(2.5E1/4.0)-s.*(t.*t).*5.729166666666667E1+s.*(t.*t.*t).*(6.25E2/4.0)-s.*(t.*t.*t.*
    t).*1.302083333333333E2+(t.*t).*6.354166666666667E1-(t.*t.*t).*2.135416666666667E2+(t.*t.*t.*t).*2.864583333333333E2-
    (t.*t.*t.*t.*t).*1.302083333333333E2

  phi[:,9] =  (s.*s).*(t.*t).*(-6.25E2/4.0)+(s.*s).*(t.*t.*t).*2.604166666666667E2+(1./3).*t.*5.0E1-s.*t.*(7.5E1/2.0)+
    s.*(t.*t).*3.229166666666667E2-s.*(t.*t.*t).*7.8125E2-(t.*t).*(3.25E2/2.0)+(t.*t.*t).*5.104166666666667E2-(t.*t.*t.*
    t).*6.25E2+(t.*t.*t.*t.*t).*2.604166666666667E2+(1./6).*(s.*s).*t.*1.25E2+(1./6).*s.*(t.*t.*t.*t).*3.125E3

  phi[:,10] =  t.*-2.5E1+(s.*s).*(t.*t).*7.8125E2-(s.*s).*(t.*t.*t).*7.8125E2-(s.*s.*s).*(t.*t).*2.604166666666667E2+s.*t.*
    9.791666666666667E1-s.*(t.*t).*7.395833333333333E2-(s.*s).*t.*1.25E2+s.*(t.*t.*t).*1.40625E3+(s.*s.*s).*t.*(6.25E2/
    1.2E1)-s.*(t.*t.*t.*t).*7.8125E2+(t.*t).*2.229166666666667E2-(t.*t.*t).*6.145833333333333E2+(t.*t.*t.*t).*6.770833333333333E2-
    (t.*t.*t.*t.*t).*2.604166666666667E2

  phi[:,11] =  t.*2.5E1-(s.*s).*(t.*t).*1.09375E3+(s.*s).*(t.*t.*t).*7.8125E2-s.*t.*1.604166666666667E2+s.*(t.*t).*7.395833333333333E2+
    (s.*s).*t.*3.697916666666667E2-s.*(t.*t.*t).*1.09375E3-(s.*s.*s).*t.*3.645833333333333E2+(s.*s.*s.*s).*t.*1.302083333333333E2-
    (t.*t).*1.604166666666667E2+(t.*t.*t).*3.697916666666667E2-(t.*t.*t.*t).*3.645833333333333E2+(t.*t.*t.*t.*t).*1.302083333333333E2+
    (1./6).*(s.*s.*s).*(t.*t).*3.125E3+(1./6).*s.*(t.*t.*t.*t).*3.125E3

  phi[:,12] =  s.*2.5E1-(s.*s).*(t.*t).*1.09375E3+(s.*s.*s).*(t.*t).*7.8125E2-s.*t.*1.604166666666667E2+s.*(t.*t).*3.697916666666667E2+
    (s.*s).*t.*7.395833333333333E2-s.*(t.*t.*t).*3.645833333333333E2-(s.*s.*s).*t.*1.09375E3+s.*(t.*t.*t.*t).*1.302083333333333E2-
    (s.*s).*1.604166666666667E2+(s.*s.*s).*3.697916666666667E2-(s.*s.*s.*s).*3.645833333333333E2+(s.*s.*s.*s.*s).*1.302083333333333E2+
    (1./6).*(s.*s).*(t.*t.*t).*3.125E3+(1./6).*(s.*s.*s.*s).*t.*3.125E3

  phi[:,13] =  s.*-2.5E1+(s.*s).*(t.*t).*7.8125E2-(s.*s).*(t.*t.*t).*2.604166666666667E2-(s.*s.*s).*(t.*t).*7.8125E2+s.*t.*
    9.791666666666667E1-s.*(t.*t).*1.25E2-(s.*s).*t.*7.395833333333333E2+s.*(t.*t.*t).*(6.25E2/1.2E1)+(s.*s.*s).*t.*1.40625E3-
    (s.*s.*s.*s).*t.*7.8125E2+(s.*s).*2.229166666666667E2-(s.*s.*s).*6.145833333333333E2+(s.*s.*s.*s).*6.770833333333333E2-
    (s.*s.*s.*s.*s).*2.604166666666667E2

  phi[:,14] =  (s.*s).*(t.*t).*(-6.25E2/4.0)+(s.*s.*s).*(t.*t).*2.604166666666667E2+(1./3).*s.*5.0E1-s.*t.*(7.5E1/2.0)+
    (s.*s).*t.*3.229166666666667E2-(s.*s.*s).*t.*7.8125E2-(s.*s).*(3.25E2/2.0)+(s.*s.*s).*5.104166666666667E2-(s.*s.*s.*
    s).*6.25E2+(s.*s.*s.*s.*s).*2.604166666666667E2+(1./6).*s.*(t.*t).*1.25E2+(1./6).*(s.*s.*s.*s).*t.*3.125E3

  phi[:,15] =  s.*(-2.5E1/4.0)+s.*t.*(2.5E1/4.0)-(s.*s).*t.*5.729166666666667E1+(s.*s.*s).*t.*(6.25E2/4.0)-(s.*s.*s.*s).*
    t.*1.302083333333333E2+(s.*s).*6.354166666666667E1-(s.*s.*s).*2.135416666666667E2+(s.*s.*s.*s).*2.864583333333333E2-
    (s.*s.*s.*s.*s).*1.302083333333333E2

  phi[:,16] =  (s.*s).*(t.*t).*2.5E3-(s.*s).*(t.*t.*t).*1.5625E3-(s.*s.*s).*(t.*t).*1.5625E3+s.*t.*2.5E2+s.*(t.*t.*t).*1.25E3+
    (s.*s.*s).*t.*1.25E3-(1./6).*s.*(t.*t).*5.875E3-(1./6).*(s.*s).*t.*5.875E3-(1./6).*s.*(t.*t.*t.*t).*3.125E3-(1./6).*
    (s.*s.*s.*s).*t.*3.125E3

  phi[:,17] =  (s.*s).*(t.*t).*(-1.71875E3)+(s.*s).*(t.*t.*t).*7.8125E2+(s.*s.*s).*(t.*t).*1.5625E3-s.*t.*1.25E2+s.*(t.*t).*
    2.8125E2+(s.*s).*t.*9.0625E2-s.*(t.*t.*t).*(6.25E2/4.0)-(s.*s.*s).*t.*1.5625E3+(s.*s.*s.*s).*t.*7.8125E2

  phi[:,18] =  (s.*s).*(t.*t).*(6.25E2/2.0)-(1./6).*(s.*s.*s).*(t.*t).*3.125E3+(1./3).*s.*t.*1.25E2-(1./3).*s.*(t.*
    t).*1.25E2+(1./3).*(s.*s.*s).*t.*2.5E3-(1./6).*(s.*s).*t.*2.125E3-(1./6).*(s.*s.*s.*s).*t.*3.125E3

  phi[:,19] =  (s.*s).*(t.*t).*(-1.71875E3)+(s.*s).*(t.*t.*t).*1.5625E3+(s.*s.*s).*(t.*t).*7.8125E2-s.*t.*1.25E2+s.*(t.*t).*
    9.0625E2+(s.*s).*t.*2.8125E2-s.*(t.*t.*t).*1.5625E3-(s.*s.*s).*t.*(6.25E2/4.0)+s.*(t.*t.*t.*t).*7.8125E2

  phi[:,20] =  (s.*s).*(t.*t).*1.09375E3-(s.*s).*(t.*t.*t).*7.8125E2-(s.*s.*s).*(t.*t).*7.8125E2+s.*t.*(1.25E2/4.0)-s.*(t.*
    t).*(3.75E2/2.0)-(s.*s).*t.*(3.75E2/2.0)+s.*(t.*t.*t).*(6.25E2/4.0)+(s.*s.*s).*t.*(6.25E2/4.0)

  phi[:,21] =  (s.*s).*(t.*t).*(6.25E2/2.0)-(1./6).*(s.*s).*(t.*t.*t).*3.125E3+(1./3).*s.*t.*1.25E2-(1./3).*(s.*s).*
    t.*1.25E2+(1./3).*s.*(t.*t.*t).*2.5E3-(1./6).*s.*(t.*t).*2.125E3-(1./6).*s.*(t.*t.*t.*t).*3.125E3

  # derivative in x
  dphi[:,1,1] =  s.*(3.75E2/4.0)+t.*(3.75E2/4.0)-(s.*s).*(t.*t).*7.8125E2-s.*t.*5.3125E2+s.*(t.*t).*9.375E2+(s.*s).*t.*9.375E2-
    s.*(t.*t.*t).*5.208333333333333E2-(s.*s.*s).*t.*5.208333333333333E2-(s.*s).*2.65625E2+(s.*s.*s).*(6.25E2/2.0)-(s.*s.*
    s.*s).*1.302083333333333E2-(t.*t).*2.65625E2+(t.*t.*t).*(6.25E2/2.0)-(t.*t.*t.*t).*1.302083333333333E2-1.37E2/1.2E1

  dphi[:,2,1] =  s.*(-1.25E2/6.0)+(s.*s).*(8.75E2/8.0)-(s.*s.*s).*(6.25E2/3.0)+(s.*s.*s.*s).*1.302083333333333E2+1.0

  dphi[:,3,1] =  0.0

  dphi[:,4,1] =  t.*(-2.5E1/4.0)+s.*t.*1.145833333333333E2-(s.*s).*t.*4.6875E2+(s.*s.*s).*t.*5.208333333333333E2

  dphi[:,5,1] =  (s.*s).*(t.*t).*7.8125E2-(1./6).*t.*2.5E1+s.*t.*(1.25E2/2.0)+(1./6).*(t.*t).*1.25E2-s.*(t.*t).*(6.25E2/
    2.0)-(s.*s).*t.*(6.25E2/4.0)

  dphi[:,6,1] =  (1./6).*t.*-2.5E1-s.*(t.*t).*(6.25E2/2.0)+s.*(t.*t.*t).*5.208333333333333E2+(t.*t).*(1.25E2/4.0)-(t.*
    t.*t).*(6.25E2/1.2E1)+(1./6).*s.*t.*2.5E2

  dphi[:,7,1] =  t.*(-2.5E1/4.0)+(t.*t).*5.729166666666667E1-(t.*t.*t).*(6.25E2/4.0)+(t.*t.*t.*t).*1.302083333333333E2

  dphi[:,8,1] =  t.*(2.5E1/4.0)-(t.*t).*5.729166666666667E1+(t.*t.*t).*(6.25E2/4.0)-(t.*t.*t.*t).*1.302083333333333E2

  dphi[:,9,1] =  t.*(-7.5E1/2.0)+(1./6).*(t.*t.*t.*t).*3.125E3-s.*(t.*t).*(6.25E2/2.0)+s.*(t.*t.*t).*5.208333333333333E2+
    (t.*t).*3.229166666666667E2-(t.*t.*t).*7.8125E2+(1./6).*s.*t.*2.5E2

  dphi[:,10,1] =  t.*9.791666666666667E1-(s.*s).*(t.*t).*7.8125E2-s.*t.*2.5E2+s.*(t.*t).*1.5625E3+(s.*s).*t.*(6.25E2/4.0)-
    s.*(t.*t.*t).*1.5625E3-(t.*t).*7.395833333333333E2+(t.*t.*t).*1.40625E3-(t.*t.*t.*t).*7.8125E2

  dphi[:,11,1] =  t.*(-1.604166666666667E2)+s.*t.*7.395833333333333E2+(1./6).*(t.*t.*t.*t).*3.125E3-s.*(t.*t).*2.1875E3-
    (s.*s).*t.*1.09375E3+s.*(t.*t.*t).*1.5625E3+(s.*s.*s).*t.*5.208333333333333E2+(t.*t).*7.395833333333333E2-(t.*t.*t).*
    1.09375E3+(1./6).*(s.*s).*(t.*t).*9.375E3

  dphi[:,12,1] =  s.*(-3.208333333333333E2)-t.*1.604166666666667E2+(s.*s).*(t.*t).*2.34375E3+s.*t.*1.479166666666667E3-
    s.*(t.*t).*2.1875E3-(s.*s).*t.*3.28125E3+(s.*s).*1.109375E3-(s.*s.*s).*1.458333333333333E3+(s.*s.*s.*s).*6.510416666666667E2+
    (t.*t).*3.697916666666667E2-(t.*t.*t).*3.645833333333333E2+(t.*t.*t.*t).*1.302083333333333E2+(1./6).*s.*(t.*t.*t).*
    6.25E3+(1./6).*(s.*s.*s).*t.*1.25E4+2.5E1

  dphi[:,13,1] =  s.*4.458333333333333E2+t.*9.791666666666667E1-(s.*s).*(t.*t).*2.34375E3-s.*t.*1.479166666666667E3+
    s.*(t.*t).*1.5625E3+(s.*s).*t.*4.21875E3-s.*(t.*t.*t).*5.208333333333333E2-(s.*s.*s).*t.*3.125E3-(s.*s).*1.84375E3+(s.*
    s.*s).*2.708333333333333E3-(s.*s.*s.*s).*1.302083333333333E3-(t.*t).*1.25E2+(t.*t.*t).*(6.25E2/1.2E1)-2.5E1

  dphi[:,14,1] =  (1./3).*5.0E1-s.*3.25E2-t.*(7.5E1/2.0)+(s.*s).*(t.*t).*7.8125E2+s.*t.*6.458333333333333E2+(1./6).*
    (t.*t).*1.25E2-s.*(t.*t).*(6.25E2/2.0)-(s.*s).*t.*2.34375E3+(s.*s).*1.53125E3-(s.*s.*s).*2.5E3+(s.*s.*s.*s).*1.302083333333333E3+
    (1./6).*(s.*s.*s).*t.*1.25E4

  dphi[:,15,1] =  s.*1.270833333333333E2+t.*(2.5E1/4.0)-s.*t.*1.145833333333333E2+(s.*s).*t.*4.6875E2-(s.*s.*s).*t.*5.208333333333333E2-
    (s.*s).*6.40625E2+(s.*s.*s).*1.145833333333333E3-(s.*s.*s.*s).*6.510416666666667E2-2.5E1/4.0

  dphi[:,16,1] =  t.*2.5E2-(s.*s).*(t.*t).*4.6875E3-(1./6).*(t.*t).*5.875E3-(1./6).*(t.*t.*t.*t).*3.125E3+s.*(t.*t).*5.0E3+
    (s.*s).*t.*3.75E3-s.*(t.*t.*t).*3.125E3+(t.*t.*t).*1.25E3-(1./6).*s.*t.*1.175E4-(1./6).*(s.*s.*s).*t.*1.25E4

  dphi[:,17,1] =  t.*-1.25E2+(s.*s).*(t.*t).*4.6875E3+s.*t.*1.8125E3-s.*(t.*t).*3.4375E3-(s.*s).*t.*4.6875E3+s.*(t.*t.*t).*1.5625E3+
    (s.*s.*s).*t.*3.125E3+(t.*t).*2.8125E2-(t.*t.*t).*(6.25E2/4.0)

  dphi[:,18,1] =  (1./3).*t.*1.25E2-(1./3).*(t.*t).*1.25E2+s.*(t.*t).*6.25E2-(1./6).*(s.*s).*(t.*t).*9.375E3-(1./6).*
    s.*t.*4.25E3+(1./3).*(s.*s).*t.*7.5E3-(1./6).*(s.*s.*s).*t.*1.25E4

  dphi[:,19,1] =  t.*-1.25E2+(s.*s).*(t.*t).*2.34375E3+s.*t.*5.625E2-s.*(t.*t).*3.4375E3-(s.*s).*t.*4.6875E2+s.*(t.*t.*t).*3.125E3+
    (t.*t).*9.0625E2-(t.*t.*t).*1.5625E3+(t.*t.*t.*t).*7.8125E2

  dphi[:,20,1] =  t.*(1.25E2/4.0)-(s.*s).*(t.*t).*2.34375E3-s.*t.*3.75E2+s.*(t.*t).*2.1875E3+(s.*s).*t.*4.6875E2-s.*(t.*t.*
    t).*1.5625E3-(t.*t).*(3.75E2/2.0)+(t.*t.*t).*(6.25E2/4.0)

  dphi[:,21,1] =  (1./3).*t.*1.25E2+(1./3).*(t.*t.*t).*2.5E3-(1./6).*(t.*t).*2.125E3-(1./6).*(t.*t.*t.*t).*3.125E3+
    s.*(t.*t).*6.25E2-(1./3).*s.*t.*2.5E2-(1./6).*s.*(t.*t.*t).*6.25E3

  # derivative in y
  dphi[:,1,2] =  s.*(3.75E2/4.0)+t.*(3.75E2/4.0)-(s.*s).*(t.*t).*7.8125E2-s.*t.*5.3125E2+s.*(t.*t).*9.375E2+(s.*s).*t.*9.375E2-
    s.*(t.*t.*t).*5.208333333333333E2-(s.*s.*s).*t.*5.208333333333333E2-(s.*s).*2.65625E2+(s.*s.*s).*(6.25E2/2.0)-(s.*s.*
    s.*s).*1.302083333333333E2-(t.*t).*2.65625E2+(t.*t.*t).*(6.25E2/2.0)-(t.*t.*t.*t).*1.302083333333333E2-1.37E2/1.2E1

  dphi[:,2,2] =  0.0

  dphi[:,3,2] =  t.*(-1.25E2/6.0)+(t.*t).*(8.75E2/8.0)-(t.*t.*t).*(6.25E2/3.0)+(t.*t.*t.*t).*1.302083333333333E2+1.0

  dphi[:,4,2] =  s.*(-2.5E1/4.0)+(s.*s).*5.729166666666667E1-(s.*s.*s).*(6.25E2/4.0)+(s.*s.*s.*s).*1.302083333333333E2

  dphi[:,5,2] =  (1./6).*s.*-2.5E1-(s.*s).*t.*(6.25E2/2.0)+(s.*s.*s).*t.*5.208333333333333E2+(s.*s).*(1.25E2/4.0)-(s.*
    s.*s).*(6.25E2/1.2E1)+(1./6).*s.*t.*2.5E2

  dphi[:,6,2] =  (s.*s).*(t.*t).*7.8125E2-(1./6).*s.*2.5E1+s.*t.*(1.25E2/2.0)+(1./6).*(s.*s).*1.25E2-s.*(t.*t).*(6.25E2/
    4.0)-(s.*s).*t.*(6.25E2/2.0)

  dphi[:,7,2] =  s.*(-2.5E1/4.0)+s.*t.*1.145833333333333E2-s.*(t.*t).*4.6875E2+s.*(t.*t.*t).*5.208333333333333E2

  dphi[:,8,2] =  s.*(2.5E1/4.0)+t.*1.270833333333333E2-s.*t.*1.145833333333333E2+s.*(t.*t).*4.6875E2-s.*(t.*t.*t).*5.208333333333333E2-
    (t.*t).*6.40625E2+(t.*t.*t).*1.145833333333333E3-(t.*t.*t.*t).*6.510416666666667E2-2.5E1/4.0

  dphi[:,9,2] =  (1./3).*5.0E1-s.*(7.5E1/2.0)-t.*3.25E2+(s.*s).*(t.*t).*7.8125E2+s.*t.*6.458333333333333E2+(1./6).*
    (s.*s).*1.25E2-s.*(t.*t).*2.34375E3-(s.*s).*t.*(6.25E2/2.0)+(t.*t).*1.53125E3-(t.*t.*t).*2.5E3+(t.*t.*t.*t).*1.302083333333333E3+
    (1./6).*s.*(t.*t.*t).*1.25E4

  dphi[:,10,2] =  s.*9.791666666666667E1+t.*4.458333333333333E2-(s.*s).*(t.*t).*2.34375E3-s.*t.*1.479166666666667E3+
    s.*(t.*t).*4.21875E3+(s.*s).*t.*1.5625E3-s.*(t.*t.*t).*3.125E3-(s.*s.*s).*t.*5.208333333333333E2-(s.*s).*1.25E2+(s.*s.*
    s).*(6.25E2/1.2E1)-(t.*t).*1.84375E3+(t.*t.*t).*2.708333333333333E3-(t.*t.*t.*t).*1.302083333333333E3-2.5E1

  dphi[:,11,2] =  s.*(-1.604166666666667E2)-t.*3.208333333333333E2+(s.*s).*(t.*t).*2.34375E3+s.*t.*1.479166666666667E3-
    s.*(t.*t).*3.28125E3-(s.*s).*t.*2.1875E3+(s.*s).*3.697916666666667E2-(s.*s.*s).*3.645833333333333E2+(s.*s.*s.*s).*1.302083333333333E2+
    (t.*t).*1.109375E3-(t.*t.*t).*1.458333333333333E3+(t.*t.*t.*t).*6.510416666666667E2+(1./6).*s.*(t.*t.*t).*1.25E4+
    (1./6).*(s.*s.*s).*t.*6.25E3+2.5E1

  dphi[:,12,2] =  s.*(-1.604166666666667E2)+s.*t.*7.395833333333333E2+(1./6).*(s.*s.*s.*s).*3.125E3-s.*(t.*t).*1.09375E3-
    (s.*s).*t.*2.1875E3+s.*(t.*t.*t).*5.208333333333333E2+(s.*s.*s).*t.*1.5625E3+(s.*s).*7.395833333333333E2-(s.*s.*s).*1.09375E3+
    (1./6).*(s.*s).*(t.*t).*9.375E3

  dphi[:,13,2] =  s.*9.791666666666667E1-(s.*s).*(t.*t).*7.8125E2-s.*t.*2.5E2+s.*(t.*t).*(6.25E2/4.0)+(s.*s).*t.*1.5625E3-
    (s.*s.*s).*t.*1.5625E3-(s.*s).*7.395833333333333E2+(s.*s.*s).*1.40625E3-(s.*s.*s.*s).*7.8125E2

  dphi[:,14,2] =  s.*(-7.5E1/2.0)+(1./6).*(s.*s.*s.*s).*3.125E3-(s.*s).*t.*(6.25E2/2.0)+(s.*s.*s).*t.*5.208333333333333E2+
    (s.*s).*3.229166666666667E2-(s.*s.*s).*7.8125E2+(1./6).*s.*t.*2.5E2

  dphi[:,15,2] =  s.*(2.5E1/4.0)-(s.*s).*5.729166666666667E1+(s.*s.*s).*(6.25E2/4.0)-(s.*s.*s.*s).*1.302083333333333E2

  dphi[:,16,2] =  s.*2.5E2-(s.*s).*(t.*t).*4.6875E3-(1./6).*(s.*s).*5.875E3-(1./6).*(s.*s.*s.*s).*3.125E3+s.*(t.*t).*3.75E3+
    (s.*s).*t.*5.0E3-(s.*s.*s).*t.*3.125E3+(s.*s.*s).*1.25E3-(1./6).*s.*t.*1.175E4-(1./6).*s.*(t.*t.*t).*1.25E4

  dphi[:,17,2] =  s.*-1.25E2+(s.*s).*(t.*t).*2.34375E3+s.*t.*5.625E2-s.*(t.*t).*4.6875E2-(s.*s).*t.*3.4375E3+(s.*s.*s).*t.*3.125E3+
    (s.*s).*9.0625E2-(s.*s.*s).*1.5625E3+(s.*s.*s.*s).*7.8125E2

  dphi[:,18,2] =  (1./3).*s.*1.25E2+(1./3).*(s.*s.*s).*2.5E3-(1./6).*(s.*s).*2.125E3-(1./6).*(s.*s.*s.*s).*3.125E3+
    (s.*s).*t.*6.25E2-(1./3).*s.*t.*2.5E2-(1./6).*(s.*s.*s).*t.*6.25E3

  dphi[:,19,2] =  s.*-1.25E2+(s.*s).*(t.*t).*4.6875E3+s.*t.*1.8125E3-s.*(t.*t).*4.6875E3-(s.*s).*t.*3.4375E3+s.*(t.*t.*t).*3.125E3+
    (s.*s.*s).*t.*1.5625E3+(s.*s).*2.8125E2-(s.*s.*s).*(6.25E2/4.0)

  dphi[:,20,2] =  s.*(1.25E2/4.0)-(s.*s).*(t.*t).*2.34375E3-s.*t.*3.75E2+s.*(t.*t).*4.6875E2+(s.*s).*t.*2.1875E3-(s.*s.*s).*
    t.*1.5625E3-(s.*s).*(3.75E2/2.0)+(s.*s.*s).*(6.25E2/4.0)

  dphi[:,21,2] =  (1./3).*s.*1.25E2-(1./3).*(s.*s).*1.25E2+(s.*s).*t.*6.25E2-(1./6).*(s.*s).*(t.*t).*9.375E3-(1./6).*
    s.*t.*4.25E3+(1./3).*s.*(t.*t).*7.5E3-(1./6).*s.*(t.*t.*t).*1.25E4

  # transpose
  phi   = phi'

  dphi2 = fill( 0.0, size(dphi,2), size(dphi,1), 2 )
  dphi2[:,:,1] = dphi[:,:,1]'
  dphi2[:,:,2] = dphi[:,:,2]'

  return phi, dphi2

end
